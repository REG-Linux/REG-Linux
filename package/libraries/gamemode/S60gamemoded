#!/bin/dash
#
# S60gamemoded - init.d script for GameMode
#

DAEMON=/usr/bin/gamemoded
PIDFILE=/var/run/gamemoded.pid

start() {
	printf 'Starting GameMode daemon: '
	start-stop-daemon -S -q -b -m -p "$PIDFILE" -x "$DAEMON"
	if [ $? -eq 0 ]; then
		printf 'done\n'
	else
		printf 'failed\n'
		exit 1
	fi
}

stop() {
	printf 'Stopping GameMode daemon: '
	if start-stop-daemon -K -q -p "$PIDFILE" --retry=TERM/2/KILL/1; then
		rm -f "$PIDFILE"
		printf 'done\n'
	else
		printf 'failed\n'
		exit 1
	fi
}

status() {
	if [ -f "$PIDFILE" ] && kill -0 "$(cat "$PIDFILE")" 2>/dev/null; then
		echo "GameMode daemon is running"
		return 0
	fi
	echo "GameMode daemon is not running"
	return 1
}

case "$1" in
	start)
		start
		;;
	stop)
		stop
		;;
	restart)
		stop
		start
		;;
	status)
		status
		;;
	*)
		echo "Usage: $0 {start|stop|restart|status}"
		exit 1
		;;
esac
