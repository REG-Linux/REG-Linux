################################################################################
#
# OpenMW
#
################################################################################

OPENMW_VERSION = openmw-49-rc8
OPENMW_SITE = https://github.com/OpenMW/openmw
OPENMW_SITE_METHOD = git
OPENMW_DEPENDENCIES = libgl lz4 yaml-cpp bullet ffmpeg openal sqlite
OPENMW_DEPENDENCIES += sdl2 librsvg boost fontconfig freetype poppler cairo
OPENMW_DEPENDENCIES += lua
#OPENMW_DEPENDENCIES += reglinux-luajit

OPENMW_SUPPORTS_IN_SOURCE_BUILD = NO

OPENMW_CONF_OPTS += -DCMAKE_BUILD_TYPE=Release
OPENMW_CONF_OPTS += -DBUILD_SHARED_LIBS=OFF
OPENMW_CONF_OPTS += -DOPENMW_UNITY_BUILD=FALSE
OPENMW_CONF_OPTS += -DENABLE_TEST=OFF
OPENMW_CONF_OPTS += -DBUILD_DOCS=OFF
OPENMW_CONF_OPTS += -DBUILD_LAUNCHER=OFF
OPENMW_CONF_OPTS += -DBUILD_OPENCS=OFF
OPENMW_CONF_OPTS += -DBUILD_WIZARD=OFF
OPENMW_CONF_OPTS += -DBUILD_BSATOOL=OFF
OPENMW_CONF_OPTS += -DBUILD_ESMTOOL=OFF
OPENMW_CONF_OPTS += -DBUILD_NIFTEST=OFF
OPENMW_CONF_OPTS += -DBUILD_MWINIIMPORTER=OFF
OPENMW_CONF_OPTS += -DBUILD_ESSIMPORTER=OFF
OPENMW_CONF_OPTS += -DBUILD_NAVMESHTOOL=OFF
OPENMW_CONF_OPTS += -DBUILD_BULLETOBJECTTOOL=OFF
OPENMW_CONF_OPTS += -DOPENMW_USE_SYSTEM_OSG=OFF
OPENMW_CONF_OPTS += -DOPENMW_USE_SYSTEM_MYGUI=OFF
OPENMW_CONF_OPTS += -DOPENMW_LTO_BUILD=ON
OPENMW_CONF_OPTS += -DUSE_LUAJIT=OFF

OPENMW_CONF_OPTS += -DOSG_CPP_EXCEPTIONS_AVAILABLE=ON \
	-D_OPENTHREADS_ATOMIC_USE_GCC_BUILTINS=1 \
	-DOPENTHREADS_ATOMIC_USE_MUTEX=ON

# MyGUI config options
OPENMW_CONF_OPTS += -DMYGUI_RENDERSYSTEM=1

# Cross-compilation trick: poppler cairo test
OPENMW_CONF_OPTS += -DPOPPLER_HAS_CAIRO_EXITCODE=0
# Cross-compilation trick: LuaJIT check custom allocator
OPENMW_CONF_OPTS += -DRUN_RESULT_VAR=1

ifeq ($(BR2_PACKAGE_XORG7),y)
OPENMW_DEPENDENCIES += xlib_libX11 xlib_libXrandr fltk
OPENMW_CONF_OPTS += -DOSG_WINDOWING_SYSTEM=X11
else
OPENMW_CONF_OPTS += -DOSG_WINDOWING_SYSTEM=None
endif

$(eval $(cmake-package))
